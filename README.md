# nico downloader

nico downloader：ニコニコ用のシンプルなChrome拡張

## コンセプト
- 動画ページでの保存ボタンの自動作成
- 動画結合処理の実装
- シンプルな機能とある程度のカスタマイズ性の両立

## おことわりと怒りの表明
1. 基本的にsm～以外の動画では動作しないようにしてあります
1. 一部の動画に暗号化されている動画がありますが、いろいろなところに抵触する為対応しません
1. 絶対に邪な使い方はしないで下さい

## 要件
|区分|数値|備考|
|:---|:---|:---|
|CPU|AMD Ryzen Zen プロセッサより新しいプロセッサ||
|RAM|16GB以上|16GB未満はサポート対象外<br>変換前にメモリ上に保存する関係でメモリを大量に使用|
|OS|Windows 11 23H2以上|Macintoshは一切の動作保証なし|
|導入するブラウザ|Chrome最新版|Chrome以外はサポート対象外(特にEdge)|
|回線|100Mbps以上<br>nicovideo.jpへのpingやfetchの疎通が常にうまくいく環境|これ未満でも動かないということはないが、自己責任でお願いします|


## 使用方法
1. 動画ページを開く
    1. 基本的にsm～から始まる動画のみサポート
    1. それ以外の動画は動作サポート対象外
1. 2秒くらい待つ
1. 動画の右下あたりに「保存」ボタンが生成ささる
1. クリックされるとシステムメッセージが自動で開かさり処理開始される
    1. 開かれたシステムメッセージはすぐ閉じて大丈夫です
1. 処理は自動で行われる
    1. ffmpegが裏で処理を行っているので少々重いかもしれない
1. 保存ダイアログが出るか既定のフォルダに保存される
    1. ここはChromeの設定に依存するため注意を要する

## しくみ
1. 動画ページのシステムメッセージ内にHLSのURLがあるので、そのURLを抽出しそのデータをキャッシュ
1. 同様に、動画のタイトルを抽出しそのデータをキャッシュ
1. キャッシュされたデータをもとにCMAFとかを取得
1. 取得したデータをffmpeg.wasmで結合
1. 結合したデータをblobとして取得
1. すでにblobになっているのでディスクに書き込めばすぐ保存終了

## QandA や　要望
|質問                   |回答               |
|:-----                 |:-----             |
|1. 保存できる画質を設定できるようにしてほしい|＜対応予定あり＞時間要します|
|2. 音声データを保存できるようにしてほしい|＜対応予定あり＞時間要します|
|3. コメントをダウンロードできるようにしてほしい|＜対応検討中＞|
|4. ダウンロードしようとしたら1KBになりました。バグらささっていると思います。|十中八九変換に失敗しています。<br>原因の一例<br>・PCのメモリが足りない(要件を読んで下さい)<br>・回線の問題でダウンロードに失敗した(要件を読んで下さい)<br>・動画が暗号化されている(おことわりを読んで下さい)<br>・動画が長すぎる(特に3時間以上)|
|5. バグを発見した|@masteralice3104へご報告下さい|
|6. Plz, I've Question by ENG or other...|I can understand "Japanese". However, I have confirmed that DeepL translation and Google Translate do not correctly translate the dialect I speak. Therefore, there is a high possibility that my intention will not be conveyed correctly.|

